<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="t" uri="/recruit-tags"%>
<%@include file="/webpage/common.jsp"%>
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="${webRoot }/resources/css/system/baseUserList.css" />
  <base href="${basePath}">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <title>任务管理</title>
  <style type="text/css">
  </style>
</head>
<body onload="removeLoad();">
<jsp:include page="/webpage/header.jsp"></jsp:include>
<div class="co">
  <div class="co-left">
    <jsp:include page="/webpage/left-bar.jsp"></jsp:include>
  </div>
  <div class="co-right">
    <div class="position-path co-right-center">
      <span class="path-title">您的位置 :</span><a class="path-item a-decoration"
                                               href="${webRoot}/loginController/main">我的首页</a><em class="path-icon">&gt;&gt;</em><span
            class="path-leaf">系统管理</span><em class="path-icon">&gt;&gt;</em><span class="path-leaf">任务管理</span>
    </div>
    <div class="co-right-main co-right-center">
      <div class="con-title">任务管理</div>
      <div class="account-content">
        <div class="account-search">
          <table class="tblQuery2">
            <tbody>
            <tr>
              <th>&nbsp;年份：</th>
              <td><input class="mini-combobox" style="width: 80px;" textField="yearth" id="yearth"
                         valueField="yearth" url="/recruit/campusTaskController/datagrid4Yearth"
                         showNullItem="true" allowInput="true" onitemclick="search()" /></td>
              <th>&nbsp;组织:</th>
              <td>
                <input
                        id="organizationId" class="mini-combobox" name="organizationId"
                        style="width: 120px;" valueField="typeId" showNullItem="true"
                        url="/recruit/datadictGroupTypeController/getDictsByCode/campus_company"
                        allowInput="true" textField="typeName" pinyinField="tag" onitemclick="search()">
              </td>
              <th>&nbsp;站点:</th>
              <td>
                <input
                        id="siteId" class="mini-combobox" name="siteId"
                        style="width: 120px;" valueField="siteId" showNullItem="true"
                        url="/recruit/campusSiteController/datagrid"
                        allowInput="true" textField="siteName" pinyinField="tag" onitemclick="search()">
              </td>
              <th>&nbsp;岗位:</th>
              <td>
                <input
                        id="postId" class="mini-combobox" name="postId"
                        style="width: 120px;" valueField="typeId" showNullItem="true"
                        url="/recruit/datadictGroupTypeController/getDictsByCode/pose_type"
                        allowInput="true" textField="typeName" pinyinField="tag" onitemclick="search()">
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="blue radius">
          <div class="table-operate">
            <input type="button" class="button radius btn" id="uploadButton" value="excel导入" onclick="onImport()"/>
            <input type="button" class="button radius btn" id="remove" value="删除" onclick="removeTask()" />
            <input type="button" class="button radius btn" id="create" value="新增" onclick="create()" />
            <input type="button" class="button radius btn" id="savaData" value="保存" onclick="saveData()" />
          </div>
          <div id="datagrid1" class="mini-datagrid" url="/recruit/campusTaskController/datagrid"
               idField="id" sizeList="[1,2,50,100]" pageSize="10" allowResize="false" style="height: 350px;" allowCellEdit="true" allowCellSelect="true">
            <div property="columns">
              <div type="checkcolumn"></div>
              <div field="yearth" width="120" allowSort="true">年份</div>
              <div field="reserved2" width="120" allowSort="true">所属组织</div>
              <div field="siteName" width="120" allowSort="true">站点名称</div>
              <div field="postName" width="120" allowSort="true">岗位名称</div>
              <div header="任务" headerAlign="center">
                <div property="columns">
                  <div field="taskNumberBa" width="70">本科
                    <input property="editor" class="mini-spinner"  minValue="0" maxValue="99999" style="width:100%;"/>
                  </div>
                  <div field="taskNumberMa" width="70">硕士
                    <input property="editor" class="mini-spinner"  minValue="0" maxValue="99999" style="width:100%;"/>
                  </div>
                  <div field="taskNumberDo" width="70">博士
                    <input property="editor" class="mini-spinner"  minValue="0" maxValue="99999" style="width:100%;"/>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<jsp:include page="/webpage/footer.jsp"></jsp:include>
</body>
<script>
    mini.parse();
    var datagrid = mini.get("datagrid1");
    datagrid.load();

    function search() {
        var yearth = mini.get("yearth").getValue();
        var organizationId = mini.get("organizationId").getValue();
        var siteId = mini.get("siteId").getValue();
        var postId = mini.get("postId").getValue();
        datagrid.load({
            yearth : yearth,
            organizationId : organizationId,
            siteId : siteId,
            postId : postId
        });
    }

    function create() {
        OpenDialog("/recruit/campusTaskController/create", "新增任务", datagrid, 350, 350);
    }

    function removeTask() {
        var data = datagrid.getSelected();
        if (data) {
            var id = data.id;
            mini.confirm("确定删除记录？<br>", "删除", function(action) {
                if (action == "ok") {
                    SaveData("/recruit/campusTaskController/remove/" + id, "", function(e) {
                        ShowActionTip(e);
                        datagrid.reload();
                    });
                }
            });
        } else {
            ShowWarnTip("请选择一条记录");
        }
    }

    function onImport() {
        mini.open({
            url : "/recruit/campusTaskController/importCampusTask",
            title : "导入任务",
            width : 400,
            height : 170,
            allowResize : false
        });
    }

    function saveData() {
        datagrid.validate();
        if (datagrid.isValid() == false) {
            var error = datagrid.getCellErrors()[0];
            mini.alert(error.errorText);
            datagrid.beginEditCell(error.record, error.column);
            return;
        }
        var data = datagrid.getChanges();
        var json = mini.encode(data);

        datagrid.loading("保存中，请稍后......");
        $.ajax({
            url : "/recruit/campusTaskController/saveData",
            dataType : 'json',
            contentType : 'application/json',
            data : json,
            type : "post",
            success : function(text) {
                mini.alert(text.msg);
                datagrid.reload();
            },
            error : function(jqXHR, textStatus, errorThrown) {
                alert(jqXHR.responseText);
            }
        });
    }


</script>
</html>
