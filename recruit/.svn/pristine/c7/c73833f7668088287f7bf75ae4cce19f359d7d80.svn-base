<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="t" uri="/recruit-tags"%>
<%@include file="/webpage/common.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="${webRoot }/resources/css/system/baseUserList.css" />
<base href="${basePath}">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<title>学生资料</title>
<style type="text/css">
</style>
</head>
<body onload="removeLoad();">
  <jsp:include page="/webpage/header.jsp"></jsp:include>
  <div class="co">
    <div class="co-left">
      <jsp:include page="/webpage/left-bar.jsp"></jsp:include>
    </div>
    <div class="co-right">
      <div class="position-path co-right-center">
        <span class="path-title">您的位置 :</span><a class="path-item a-decoration"
          href="${webRoot}/loginController/main">我的首页</a><em class="path-icon">&gt;&gt;</em><span
          class="path-leaf">招聘支持</span><em class="path-icon">&gt;&gt;</em><span class="path-leaf">学生资料</span>
      </div>
      <div class="co-right-main co-right-center">
        <div class="con-title">学生资料管理</div>
        <div class="account-content">
          <div class="account-search">
            <table class="tblQuery2">
              <tbody>
                <tr>
                  <td>站点&nbsp;&nbsp;&nbsp;&nbsp;</td>
                  <td><input class="mini-combobox" style="width: 180px;" textField="siteName"
                    name="siteId" valueField="siteId" id="siteKey" allowInput="true"
                    url="/recruit/campusAddressbookController/getSiteName" /></td>
                  <td>&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 职位类&nbsp;&nbsp; &nbsp;&nbsp;</td>
                  <td class="formContent"><input class="mini-combobox" style="width: 180px;"
                    textField="postName" name="postId" valueField="id" id="postKey"
                    allowInput="true" url="/recruit/campusPostController/datagrid" /></td>
                </tr>
                <tr>
                  <td>姓名&nbsp;&nbsp;&nbsp;&nbsp;</td>
                  <td><input emptyText="请输入姓名" style="width: 180px" class="mini-textbox"
                    id="nameKey" allowInput="true"></td>
                  <td>&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 学校&nbsp;&nbsp;&nbsp;&nbsp;</td>
                  <td><input emptyText="请输入学校" style="width: 180px" class="mini-textbox"
                    id="schoolKey"></td>
                  <td>&nbsp;&nbsp; <input type="submit" value="搜索" tabindex="5"
                    onenter="onKeyEnter" class="search_btn" id="btnRefresh" onclick="search()"
                    name="btnRefresh">
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="blue radius">
            <div class="table-operate">
              <input type="button" class="button radius btn" id="uploadButton" value="导入"
                onclick="onImport()" />&nbsp;&nbsp;<input type="button" class="button radius btn"
                id="create" value="新增" onclick="create()" />&nbsp;&nbsp;<input type="button"
                class="button radius btn" id="modify" value="修改" onclick="modify()" />&nbsp;&nbsp;<input
                type="button" class="button radius btn" id="remove" value="删除" onclick="remove()" />&nbsp;&nbsp;<input
                type="button" class="button radius btn" id="call" value="呼叫" onclick="call()" />&nbsp;&nbsp;&nbsp;
              <input type="button" id="send" value="发送邮件" onclick="send()" />&nbsp;&nbsp; <input
                type="button" class="button radius btn" id="export" value="导出" onclick="onExport()" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <td vlink="#46a3ff"><a href="javascript:showColumn();">显示设置</a></td>
            </div>
            <div id="datagrid1" class="mini-datagrid"
              url="/recruit/campusStudentController/datagrid" idField="id" sizeList="[1,20,50,100]"
              pageSize="20" allowResize="true" style="height: 500px;">
              <div property="columns">
                <div type="checkcolumn" width="30"></div>
                <div name="siteName" field="siteName" width="40" allowSort="true">站点</div>
                <div name="workingPlace" field="workingPlace" width="60" headerAlign="center" allowSort="true">工作地点</div>
                <div name="organization" field="organization" width="40" allowSort="true">组织</div>
                <div name="bigCenter" field="bigCenter" width="45" allowSort="true">大中心</div>
                <div name="smallCenter" field="smallCenter" width="65" allowSort="true">长/小中心</div>
                <div name="department" field="department" width="40" allowSort="false">部门</div>
                <div name="offices" field="offices" width="40" allowSort="false">科室</div>
                <div name="postName" field="postName" width="40" allowSort="true">岗位</div>
                <div name="realname" field="realname" width="40" allowSort="true">姓名</div>
                <div name="sex" field="sex" width="40" allowSort="true" renderer="onSexRenderer">性别</div>
                <div name="education" field="education" width="40" allowSort="true">学历</div>
                <div name="nativePlace" field="nativePlace" width="40" allowSort="true">籍贯</div>
                <div name="school" field="school" width="40" allowSort="false">学校</div>
                <div name="major" field="major" width="40" allowSort="false">专业</div>
                <div name="phoneNo" field="phoneNo" width="60" allowSort="true">联系方式</div>
                <div name="email" field="email" width="40" allowSort="true">邮箱</div>
                <div name="evaluation" field="evaluation" width="60" allowSort="true">测评成绩</div>
                <div name="moraleRisk" field="moraleRisk" width="60" allowSort="true">心理风险</div>
                <div name="resultFirst" field="resultFirst" width="60" allowSort="true">一面得分</div>
                <div name="resultSecond" field="resultSecond" width="60" allowSort="false">二面得分</div>
                <div name="offer" field="offer" width="40" allowSort="false">Offer</div>
                <div name="idcardCopy" field="idcardCopy" width="85" allowSort="true">身份证复印件</div>
                <div name="trilateral" field="trilateral" width="60" allowSort="true">三方协议</div>
                <div name="referenceForm" field="referenceForm" width="70" allowSort="true">就业推荐表</div>
                <div name="transcript" field="transcript" width="45" allowSort="true">成绩单</div>
                <div name="cetTranscript" field="cetTranscript" width="80" allowSort="false">四六级成绩单</div>
                <div name="photo" field="photo" width="40" allowSort="false">照片</div>
                <div name="breakOff" field="breakOff" width="60" allowSort="false">违约情况</div>
                <div name="yearth" field="yearth" width="60" allowSort="false">招聘年份期数</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <jsp:include page="/webpage/footer.jsp"></jsp:include>
</body>
<script>
  mini.parse();
  var datagrid = mini.get("datagrid1");
  datagrid.load();

  var sexStr = [ {
    id : 1,
    text : '女'
  }, {
    id : 2,
    text : '男'
  } ];

  //模板类型渲染
  function onSexRenderer(e) {
    for (var i = 0, l = sexStr.length; i < l; i++) {
      var g = sexStr[i];
      if (g.id == e.value)
        return g.text;
    }
    return "";
  }

  function search() {
    var siteId = mini.get("siteKey").getValue();
    var postId = mini.get("postKey").getValue();
    var stuName = mini.get("nameKey").getValue();
    var school = mini.get("schoolKey").getValue();
    datagrid.load({
      siteId : siteId,
      postId : postId,
      stuName : stuName,
      school : school
    });
  }

  function onKeyEnter(e) {
    search();
  }

  function create() {
    OpenDialog("/recruit/campusStudentController/create/", "新建人员信息", datagrid, 780, 650);
  }

  function modify() {
    var row = datagrid.getSelected();
    if (row) {
      OpenDialog("/recruit/campusStudentController/modify/" + row.id, "编辑人员信息", datagrid, 780, 650);
    } else {
      ShowWarnTip("请选择一条记录");
    }
  }

  function remove() {
    var data = datagrid.getSelected();
    if (data) {
      var id = data.id;
      mini.confirm("确定删除记录？<br>", "删除", function(action) {
        if (action == "ok") {
          SaveData("/recruit/campusStudentController/remove/" + id, "", function(e) {
            ShowActionTip(e);
            datagrid.reload();
          });
        }
      });
    } else {
      ShowWarnTip("请选择一条记录");
    }
  }

  //导入学生信息模板表
  function onImport() {
    mini.open({
      url : "/recruit/campusStudentController/importStudentInfo",
      title : "导入学生信息模板表",
      width : 400,
      height : 110,
      allowResize : false
    });
  }

  //导出学生详细信息
  function onExport() {

    var siteId = mini.get("siteKey").getValue();
    var postId = mini.get("postKey").getValue();
    var stuName = mini.get("nameKey").getValue();
    var school = mini.get("schoolKey").getValue();
    siteId = encodeURI(encodeURI(siteId)); // url传参非asc码必须先转码再传，否则会出现乱码
    postId = encodeURI(encodeURI(postId));
    stuName = encodeURI(encodeURI(stuName));
    school = encodeURI(encodeURI(school));
    window.location.href = "/recruit/campusStudentController/exportCampusStudentInfo?siteId="
        + siteId + "&postId=" + postId + "&stuName=" + stuName + "&school=" + school;
  }

  //设置显示的字段
  function showColumn() {

    OpenDialog("/recruit/campusStudentController/showColumn", "设置显示字段", "", 480, 350, function(
        action) {
      if (action == "ok") {
        var iframe = this.getIFrameEl();
        var data = iframe.contentWindow.getData();
        data = mini.clone(data);
        var showData = [];
        showData = data.split(",");
        var dataColumn = [ "siteName", "workingPlace", "organization", "bigCenter", "smallCenter",
            "department", "offices", "postName", "realname", "sex", "education", "nativePlace",
            "school", "major", "phoneNo", "email", "evaluation", "moraleRisk", "resultFirst",
            "resultSecond", "yearth" ];
        if ("" == data || null == data) {
           for (var j = 0; j < dataColumn.length; j++) {
            datagrid.showColumn(dataColumn[j]);
          }          
        } else {
          for (var j = 0; j < dataColumn.length; j++) {
            datagrid.hideColumn(dataColumn[j]);
          }
          for (var i = 0; i < showData.length; i++) {
            datagrid.showColumn(showData[i]);
          }
        }

      }
    });
  }
</script>
</html>