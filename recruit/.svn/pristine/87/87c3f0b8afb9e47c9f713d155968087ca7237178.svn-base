<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="/webpage/common.jsp"%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="${webRoot }/resources/css/system/baseUserList.css" />
<title>短信模板管理</title>
<style>
.mini-grid-rows-view {
  height: auto;
}

.mini-grid-emptyText {
  padding: 0px !important;
  font-size: 17px !important;
}

.tool-bar {
  margin-bottom: 10px;
}
</style>
</head>
<body>
  <jsp:include page="/webpage/header.jsp"></jsp:include>
  <div class="co">
    <div class="co-left">
      <jsp:include page="/webpage/left-bar.jsp"></jsp:include>
    </div>

    <div class="co-right">
      <div class="position-path co-right-center">
        <span class="path-title">您的位置 :</span><a class="path-item a-decoration"
          href="${webRoot}/loginController/main">我的首页</a><em class="path-icon">&gt;&gt;</em><a
          class="path-item a-decoration">系统管理</a><em class="path-icon">&gt;&gt;</em><span
          class="path-leaf">短信模板管理</span>
      </div>
      <div class="co-right-main co-right-center">
        <div class="con-title">邮件模板管理</div>
        <div class="account-content">
          <div class="blue radius">
            <div class="table-operate">
              <input type="button" class="button radius btn" id="create" value="新增"
                onclick="create()" /> <input type="button" class="button radius btn" id="edit"
                value="修改" onclick="edit()" /> <input type="button" class="button radius btn"
                id="remove" value="删除" onclick="remove()" /> <input id="key" class="mini-textbox"
                emptyText="请输入模板名称" style="width: 150px;" onenter="onKeyEnter" /> <a
                class="mini-button" onclick="search()">查询</a>
              </td>
            </div>

            <div id="datagrid1" class="mini-datagrid" style="width: 100%; height: 100%;"
              url="${webRoot}/templateController/templateData" idField="id" sizeList="[5,10,20,50]"
              pageSize="20" allowResize="true">
              <div property="columns">
                <div type="checkcolumn" width="50"></div>
                <!-- <div type="indexcolumn" width="50">序号</div>    -->            
                <div field="title" allowSort="true" width="150">邮件模板名称</div>
                <div field="type" width="100" allowSort="true" renderer="onTypeRenderer">模板类型</div>
                <div field="updateDate" width="150" allowSort="true" renderer="onDateRenderer">最后修订时间</div>
                <div field="creator" width="100" allowSort="true">修订者</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%@ include file="/webpage/footer.jsp"%>
  <script type="text/javascript">
      mini.parse();
      var grid = mini.get("datagrid1");

      var type = "2";
      grid.load({
        type : type
      });
      removeLoad();
      grid.sortBy("updateDate", "desc");

      //日期格式渲染
      function onDateRenderer(e) {
        var value = e.value;
        if (value)
          return new Date(value).format("yyyy-MM-dd hh:mm:ss");
        return "";
      }

      var types = [ {
        id : 1,
        text : '邮件模板'
      }, {
        id : 2,
        text : '短信模板'
      } ];

      //模板类型渲染
      function onTypeRenderer(e) {
        for (var i = 0, l = types.length; i < l; i++) {
          var g = types[i];
          if (g.id == e.value)
            return g.text;
        }
        return "";
      }

      function search() {
        var searchKey = mini.get("key").getValue();
        grid.load({
          searchKey : searchKey,
        });
      }

      function create() {
        OpenDialog("${webRoot}/templateController/createMessage", "新建短信模板", grid, 880, 600);
      }

      function edit() {
        var row = grid.getSelected();
        if (row) {
          OpenDialog("${webRoot}/templateController/modifyMessage/" + row.id, "编辑短信模板", grid, 880,
              600);
        } else {
          mini.alert("请选择一条记录!");
        }
      }

      function remove() {
        var row = grid.getSelected();
        if (row) {
          $.ajax({
            url : "${webRoot}/templateController/remove/" + row.id,
            type : "post",
            dataType : "json",
            contentType : "application/json",
            success : function(data) {
              if (data.success == true) {
                mini.alert("删除成功！");
              } else {
                mini.alert("删除失败！" + data.msg);
              }
              grid.reload();
            },
            error : function(jqXHR, textStatus, errorThrown) {
              alert(jqXHR.responseText);
            }
          });
        } else {
          mini.alert("请选择一条记录!");
        }
      }
    </script>
</body>
</html>